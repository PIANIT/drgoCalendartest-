<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÏùºÏ†ï Î∑∞Ïñ¥ ‚Äî DRGO Calendar</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #111111;
  --surface: #1c1c1c;
  --surface2: #272727;
  --surface3: #303030;
  --border: #3a3a3a;
  --accent: #d4bc96;
  --accent2: #90bcd4;
  --text: #f0ebe2;
  --text-muted: #a09890;
  --red: #d48888;
  --green: #88d488;
  --chip-gold-bg: #c8a870;
  --chip-gold-text: #1a1207;
  --chip-blue-bg: #7aaec8;
  --chip-blue-text: #061825;
  --chip-red-bg: #c87070;
  --chip-red-text: #200808;
  --chip-green-bg: #70c870;
  --chip-green-text: #08200a;
  --chip-purple-bg: #9b70c8;
  --chip-purple-text: #f0eaff;
  --font-main: "Malgun Gothic","ÎßëÏùÄ Í≥†Îîï",-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
  --font-mono: 'DM Mono',"Malgun Gothic","ÎßëÏùÄ Í≥†Îîï",monospace;
}
html.light {
  --bg: #f7f4f0; --surface: #ffffff; --surface2: #efebe4; --surface3: #e8e2d8;
  --border: #d8d0c4; --accent: #9c7d48; --accent2: #3a7a9a;
  --text: #1e1812; --text-muted: #7a6e60; --red: #a84444; --green: #3a8a3a;
  --chip-gold-bg: #b89558; --chip-gold-text: #ffffff;
  --chip-blue-bg: #5898ba; --chip-blue-text: #ffffff;
  --chip-red-bg: #b85858; --chip-red-text: #ffffff;
  --chip-green-bg: #58b058; --chip-green-text: #ffffff;
  --chip-purple-bg: #7b50a8; --chip-purple-text: #ffffff;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { background:var(--bg); color:var(--text); font-family:var(--font-main); min-height:100vh; }

/* ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ */
#authOverlay {
  display:flex; position:fixed; inset:0; z-index:9999;
  background:var(--bg); align-items:center; justify-content:center;
}
#authOverlay.hidden { display:none; }
.auth-box {
  width:100%; max-width:360px; padding:44px 32px 36px;
  background:var(--surface); border:1px solid var(--border);
  border-radius:20px; box-shadow:0 24px 64px rgba(0,0,0,0.55);
  display:flex; flex-direction:column; align-items:center;
}
.auth-logo { font-family:var(--font-mono); font-size:11px; letter-spacing:0.25em; color:var(--text-muted); text-transform:uppercase; margin-bottom:20px; }
.auth-icon { font-size:32px; margin-bottom:8px; }
.auth-title { font-size:18px; font-weight:700; color:var(--accent); margin-bottom:4px; }
.auth-sub { font-size:11px; color:var(--text-muted); letter-spacing:0.1em; margin-bottom:28px; }
.auth-input {
  width:100%; padding:12px 16px; font-size:15px; margin-bottom:12px;
  background:var(--surface2); border:1.5px solid var(--border);
  border-radius:10px; color:var(--text); font-family:var(--font-main);
  outline:none; transition:border-color 0.2s; letter-spacing:0.1em;
}
.auth-input:focus { border-color:var(--accent); }
.auth-input.error { border-color:var(--red); animation:shake 0.35s ease; }
@keyframes shake {
  0%,100%{transform:translateX(0)} 20%{transform:translateX(-8px)}
  40%{transform:translateX(8px)} 60%{transform:translateX(-5px)} 80%{transform:translateX(5px)}
}
.auth-btn {
  width:100%; padding:13px; background:var(--accent); color:#1a1207;
  border:none; border-radius:10px; font-size:14px; font-weight:700;
  font-family:var(--font-main); cursor:pointer; transition:all 0.2s;
}
.auth-btn:hover { background:#e0cc9e; transform:translateY(-1px); }
.auth-btn:disabled { opacity:0.45; cursor:not-allowed; transform:none; }
.auth-error { margin-top:10px; font-size:12px; color:var(--red); text-align:center; min-height:18px; }
.auth-lock  { margin-top:5px; font-size:11px; color:var(--text-muted); text-align:center; }

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  display:flex; align-items:center; justify-content:space-between;
  padding:14px 32px; border-bottom:1px solid var(--border);
  position:sticky; top:0; z-index:10; background:var(--bg);
}
.header-left { display:flex; align-items:center; gap:14px; }
.app-title { font-family:var(--font-mono); font-size:12px; letter-spacing:0.22em; color:var(--accent); text-transform:uppercase; }
.view-badge {
  font-family:var(--font-mono); font-size:10px; letter-spacing:0.15em;
  padding:3px 10px; border-radius:4px; text-transform:uppercase;
  background:rgba(144,188,212,0.12); color:var(--accent2); border:1px solid rgba(144,188,212,0.3);
}
.header-right { display:flex; align-items:center; gap:8px; }
.icon-btn {
  background:none; border:1px solid var(--border); color:var(--text-muted);
  width:32px; height:32px; border-radius:7px; cursor:pointer; font-size:15px;
  display:flex; align-items:center; justify-content:center; transition:all 0.2s;
}
.icon-btn:hover { border-color:var(--accent); color:var(--accent); }

/* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
.stats-bar {
  display:grid; grid-template-columns:repeat(6,1fr); gap:1px;
  background:var(--border); border-bottom:1px solid var(--border);
}
.stat-card { background:var(--surface); padding:14px 20px; display:flex; flex-direction:column; gap:3px; }
.stat-label { font-family:var(--font-mono); font-size:10px; letter-spacing:0.18em; color:var(--text-muted); text-transform:uppercase; }
.stat-value { font-size:22px; font-weight:700; font-family:var(--font-mono); color:var(--text); }
.stat-value.gold   { color:var(--chip-gold-bg); }
.stat-value.blue   { color:var(--chip-blue-bg); }
.stat-value.red    { color:var(--chip-red-bg); }
.stat-value.green  { color:var(--chip-green-bg); }
.stat-value.purple { color:var(--chip-purple-bg); }

/* ‚îÄ‚îÄ TOOLBAR ‚îÄ‚îÄ */
.toolbar {
  display:flex; align-items:center; gap:10px; padding:12px 32px;
  border-bottom:1px solid var(--border); flex-wrap:wrap;
}
.search-wrap { position:relative; flex:1; min-width:180px; max-width:340px; }
.search-icon { position:absolute; left:11px; top:50%; transform:translateY(-50%); font-size:13px; color:var(--text-muted); pointer-events:none; }
.search-input {
  width:100%; padding:8px 11px 8px 33px; font-size:13px;
  background:var(--surface2); border:1px solid var(--border);
  border-radius:8px; color:var(--text); font-family:var(--font-main);
  outline:none; transition:border-color 0.2s;
}
.search-input:focus { border-color:var(--accent); }

.filter-group { display:flex; gap:5px; flex-wrap:wrap; }
.filter-btn {
  padding:6px 12px; border-radius:7px; border:1px solid var(--border);
  background:var(--surface2); color:var(--text-muted); font-size:12px;
  cursor:pointer; transition:all 0.15s; font-family:var(--font-main); font-weight:500;
  display:flex; align-items:center; gap:5px; white-space:nowrap;
}
.filter-btn:hover { border-color:var(--accent); color:var(--accent); }
.filter-btn.active { border-color:var(--accent); background:rgba(212,188,150,0.15); color:var(--accent); font-weight:600; }
.filter-btn.f-gold.active   { border-color:var(--chip-gold-bg);   background:rgba(200,168,112,0.15); color:var(--chip-gold-bg); }
.filter-btn.f-blue.active   { border-color:var(--chip-blue-bg);   background:rgba(122,174,200,0.15); color:var(--chip-blue-bg); }
.filter-btn.f-red.active    { border-color:var(--chip-red-bg);    background:rgba(200,112,112,0.15); color:var(--chip-red-bg); }
.filter-btn.f-green.active  { border-color:var(--chip-green-bg);  background:rgba(112,200,112,0.15); color:var(--chip-green-bg); }
.filter-btn.f-purple.active { border-color:var(--chip-purple-bg); background:rgba(155,112,200,0.15); color:var(--chip-purple-bg); }
.color-dot { width:7px; height:7px; border-radius:50%; flex-shrink:0; }
.cd-gold  { background:var(--chip-gold-bg); }
.cd-blue  { background:var(--chip-blue-bg); }
.cd-red   { background:var(--chip-red-bg); }
.cd-green { background:var(--chip-green-bg); }
.cd-purple{ background:var(--chip-purple-bg); }

/* ‚îÄ‚îÄ DATE RANGE ‚îÄ‚îÄ */
.date-range-wrap { display:flex; align-items:center; gap:6px; }
.date-range-label { font-family:var(--font-mono); font-size:10px; letter-spacing:0.15em; text-transform:uppercase; color:var(--text-muted); white-space:nowrap; }
.date-range-input-wrap {
  display:inline-flex; cursor:pointer; border-radius:7px;
  border:1px solid var(--border); background:var(--surface2);
  transition:border-color 0.2s; overflow:hidden;
}
.date-range-input-wrap:focus-within { border-color:var(--accent); }
.date-range-input {
  padding:6px 9px; font-size:12px; font-family:var(--font-mono);
  background:transparent; border:none; color:var(--text); outline:none;
  cursor:pointer; color-scheme:dark; width:130px;
}
html.light .date-range-input { color-scheme:light; }
.date-range-sep { color:var(--text-muted); font-size:12px; }
.date-range-clear {
  background:none; border:1px solid var(--border); color:var(--text-muted);
  padding:5px 9px; border-radius:7px; font-size:11px; cursor:pointer;
  font-family:var(--font-mono); transition:all 0.15s;
}
.date-range-clear:hover { border-color:var(--red); color:var(--red); }

/* ‚îÄ‚îÄ SORT BAR ‚îÄ‚îÄ */
.sort-bar {
  display:grid; align-items:center; padding:9px 32px;
  border-bottom:1px solid var(--border);
  font-family:var(--font-mono); font-size:11px; color:var(--text-muted);
  letter-spacing:0.1em; text-transform:uppercase;
  grid-template-columns: 2fr 1fr 1fr 80px 100px;
  gap:12px;
}
.sort-col { cursor:pointer; user-select:none; display:flex; align-items:center; gap:4px; transition:color 0.15s; }
.sort-col:hover { color:var(--accent); }
.sort-col.active { color:var(--accent); }
.sort-arrow { font-size:10px; opacity:0.6; }

/* ‚îÄ‚îÄ EVENT LIST ‚îÄ‚îÄ */
.events-container { padding:0 32px 100px; }
.event-row {
  display:grid; align-items:center; padding:12px 4px;
  border-bottom:1px solid rgba(58,58,58,0.6);
  grid-template-columns: 2fr 1fr 1fr 80px 100px;
  gap:12px; cursor:pointer; transition:background 0.12s; border-radius:4px;
}
.event-row:hover { background:var(--surface); }

.row-title { display:flex; align-items:center; gap:8px; min-width:0; }
.color-bar { width:3px; height:28px; border-radius:2px; flex-shrink:0; }
.cb-gold   { background:var(--chip-gold-bg); }
.cb-blue   { background:var(--chip-blue-bg); }
.cb-red    { background:var(--chip-red-bg); }
.cb-green  { background:var(--chip-green-bg); }
.cb-purple { background:var(--chip-purple-bg); }
.title-text { font-size:14px; font-weight:500; color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.title-sub  { font-size:11px; color:var(--text-muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; margin-top:1px; }

.row-date   { font-family:var(--font-mono); font-size:12px; color:var(--text-muted); }
.row-person { font-size:13px; color:var(--text-muted); white-space:normal; overflow:hidden; line-height:1.4; }
.row-badge  {
  display:inline-flex; align-items:center; padding:3px 9px; border-radius:5px;
  font-family:var(--font-mono); font-size:10px; font-weight:600; letter-spacing:0.06em; white-space:nowrap;
}
.rb-gold   { background:rgba(200,168,112,0.18); color:var(--chip-gold-bg);   border:1px solid rgba(200,168,112,0.3); }
.rb-blue   { background:rgba(122,174,200,0.18); color:var(--chip-blue-bg);   border:1px solid rgba(122,174,200,0.3); }
.rb-red    { background:rgba(200,112,112,0.18); color:var(--chip-red-bg);    border:1px solid rgba(200,112,112,0.3); }
.rb-green  { background:rgba(112,200,112,0.18); color:var(--chip-green-bg);  border:1px solid rgba(112,200,112,0.3); }
.rb-purple { background:rgba(155,112,200,0.18); color:var(--chip-purple-bg); border:1px solid rgba(155,112,200,0.3); }
.row-flags { display:flex; gap:3px; flex-wrap:wrap; font-size:13px; }

.empty-state { text-align:center; padding:80px 0; color:var(--text-muted); }
.empty-icon  { font-size:48px; margin-bottom:16px; opacity:0.4; }
.empty-text  { font-size:14px; }

/* ‚îÄ‚îÄ DETAIL MODAL ‚îÄ‚îÄ */
.modal-overlay {
  display:none; position:fixed; inset:0;
  background:rgba(0,0,0,0.75); z-index:100;
  backdrop-filter:blur(6px); align-items:center; justify-content:center; padding:24px;
}
.modal-overlay.open { display:flex; }
.modal {
  background:var(--surface); border:1px solid var(--border); border-radius:16px;
  width:100%; max-width:680px; max-height:88vh; overflow-y:auto;
  animation:modalIn 0.2s ease;
}
@keyframes modalIn { from{opacity:0;transform:translateY(16px) scale(0.97)} to{opacity:1;transform:none} }
.modal-strip { height:4px; border-radius:16px 16px 0 0; }
.ms-gold   { background:var(--chip-gold-bg); }
.ms-blue   { background:var(--chip-blue-bg); }
.ms-red    { background:var(--chip-red-bg); }
.ms-green  { background:var(--chip-green-bg); }
.ms-purple { background:var(--chip-purple-bg); }
.modal-header { padding:20px 24px 16px; display:flex; align-items:flex-start; justify-content:space-between; gap:12px; border-bottom:1px solid var(--border); }
.modal-header-info { flex:1; min-width:0; }
.modal-badge { font-family:var(--font-mono); font-size:10px; letter-spacing:0.15em; color:var(--text-muted); text-transform:uppercase; margin-bottom:6px; }
.modal-event-title { font-size:20px; font-weight:600; color:var(--text); }
.modal-close { background:none; border:1px solid var(--border); color:var(--text-muted); width:32px; height:32px; border-radius:8px; cursor:pointer; font-size:15px; display:flex; align-items:center; justify-content:center; transition:all 0.2s; flex-shrink:0; }
.modal-close:hover { border-color:var(--red); color:var(--red); }
.modal-body { padding:20px 24px 0; display:flex; flex-direction:column; gap:16px; }
.detail-section { display:flex; flex-direction:column; gap:8px; }
.detail-section-title { font-family:var(--font-mono); font-size:10px; letter-spacing:0.22em; text-transform:uppercase; color:var(--text-muted); display:flex; align-items:center; gap:10px; }
.detail-section-title::after { content:''; flex:1; height:1px; background:var(--border); }
.detail-grid { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; }
.detail-item { background:var(--surface2); border-radius:8px; padding:10px 13px; }
.detail-key  { font-family:var(--font-mono); font-size:10px; letter-spacing:0.15em; color:var(--text-muted); text-transform:uppercase; margin-bottom:4px; }
.detail-val  { font-size:13px; color:var(--text); word-break:break-word; white-space:pre-wrap; }
.detail-val.empty { color:var(--text-muted); font-style:italic; }
.flags-row { display:flex; gap:6px; flex-wrap:wrap; }
.flag-chip { display:inline-flex; align-items:center; gap:4px; padding:4px 10px; border-radius:6px; font-size:12px; background:var(--surface2); border:1px solid var(--border); color:var(--text-muted); }
.modal-footer { padding:16px 24px 20px; display:flex; justify-content:flex-end; border-top:1px solid var(--border); margin-top:20px; }
.btn-modal-close { background:var(--accent); color:#1a1207; border:none; padding:9px 28px; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; transition:all 0.2s; font-family:var(--font-main); }
.btn-modal-close:hover { background:#e0cc9e; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position:fixed; bottom:28px; left:50%; transform:translateX(-50%) translateY(20px);
  background:var(--surface); border:1px solid var(--border); border-radius:10px;
  padding:12px 20px; font-size:13px; box-shadow:0 8px 28px rgba(0,0,0,0.4);
  opacity:0; transition:all 0.25s; z-index:9999; white-space:nowrap;
}
.toast.show { opacity:1; transform:translateX(-50%) translateY(0); }
.toast.success { border-color:var(--green); color:var(--green); }
.toast.error   { border-color:var(--red);   color:var(--red); }
.toast.info    { border-color:var(--accent); color:var(--accent); }

/* ‚îÄ‚îÄ PAGINATION ‚îÄ‚îÄ */
.pagination { display:flex; align-items:center; gap:8px; padding:18px 32px; border-top:1px solid var(--border); position:fixed; bottom:0; left:0; right:0; background:var(--bg); }
.page-btn { padding:6px 12px; border-radius:6px; border:1px solid var(--border); background:var(--surface2); color:var(--text-muted); font-size:12px; cursor:pointer; transition:all 0.15s; font-family:var(--font-mono); }
.page-btn:hover { border-color:var(--accent); color:var(--accent); }
.page-btn.active { background:rgba(212,188,150,0.2); border-color:var(--accent); color:var(--accent); font-weight:700; }
.page-btn:disabled { opacity:0.35; cursor:not-allowed; }
.page-info { font-family:var(--font-mono); font-size:11px; color:var(--text-muted); margin-left:auto; letter-spacing:0.08em; }

/* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:999px; }

@media (max-width:900px) {
  .stats-bar { grid-template-columns:repeat(3,1fr); }
  .sort-bar  { display:none; }
  .event-row { grid-template-columns: 2fr 80px 90px; gap:8px; }
  .hide-m    { display:none; }
  .toolbar   { padding:10px 14px; gap:8px; }
  .events-container { padding:0 12px 100px; }
  header     { padding:10px 14px; }
}
@media (max-width:600px) {
  .date-range-wrap { display:none; }
  .filter-group { display:none; }
  .stats-bar { grid-template-columns:repeat(2,1fr); }
}
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê -->
<div id="authOverlay">
  <div class="auth-box">
    <div class="auth-logo">Calendar ¬∑ DRGO</div>
    <div class="auth-icon">üìÖ</div>
    <div class="auth-title">ÏùºÏ†ï Î∑∞Ïñ¥</div>
    <div class="auth-sub">SCHEDULE VIEWER</div>
    <input class="auth-input" type="password" id="authInput" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏" autocomplete="current-password" maxlength="32" />
    <button class="auth-btn" id="authBtn">Ï†ëÏÜç</button>
    <div class="auth-error" id="authError"></div>
    <div class="auth-lock"  id="authLock"></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê -->
<header>
  <div class="header-left">
    <span class="app-title">üìÖ ÏùºÏ†ï Î∑∞Ïñ¥</span>
    <span class="view-badge">View Only</span>
  </div>
  <div class="header-right">
    <button class="icon-btn" id="themeBtn" title="ÌÖåÎßà">üåô</button>
  </div>
</header>

<!-- ‚ïê‚ïê‚ïê STATS ‚ïê‚ïê‚ïê -->
<div class="stats-bar">
  <div class="stat-card"><div class="stat-label">Ï†ÑÏ≤¥</div><div class="stat-value" id="st-total">‚Äî</div></div>
  <div class="stat-card"><div class="stat-label">Í∞úÏù∏ÏùòÎ¢∞</div><div class="stat-value gold"   id="st-gold">‚Äî</div></div>
  <div class="stat-card"><div class="stat-label">ÏÇ¨ÎÇ¥ÏóÖÎ¨¥</div><div class="stat-value blue"   id="st-blue">‚Äî</div></div>
  <div class="stat-card"><div class="stat-label">Ìú¥Í∞ÄÍ¥ÄÎ†®</div><div class="stat-value red"    id="st-red">‚Äî</div></div>
  <div class="stat-card"><div class="stat-label">Ï¥¨ÏòÅÍ¥ÄÎ†®</div><div class="stat-value green"  id="st-green">‚Äî</div></div>
  <div class="stat-card"><div class="stat-label">ÎØ∏ÌåÖ/ÎÇ¥Î∞©</div><div class="stat-value purple" id="st-purple">‚Äî</div></div>
</div>

<!-- ‚ïê‚ïê‚ïê TOOLBAR ‚ïê‚ïê‚ïê -->
<div class="toolbar">
  <div class="search-wrap">
    <span class="search-icon">üîç</span>
    <input class="search-input" id="searchInput" placeholder="Ï†úÎ™©, Ïù¥Î¶Ñ, Ï£ºÏÜå Í≤ÄÏÉâ‚Ä¶" />
  </div>
  <div class="filter-group" id="filterGroup">
    <button class="filter-btn active" data-filter="all">Ï†ÑÏ≤¥</button>
    <button class="filter-btn f-gold"   data-filter="gold">  <span class="color-dot cd-gold"></span>Í∞úÏù∏ÏùòÎ¢∞</button>
    <button class="filter-btn f-blue"   data-filter="blue">  <span class="color-dot cd-blue"></span>ÏÇ¨ÎÇ¥ÏóÖÎ¨¥</button>
    <button class="filter-btn f-red"    data-filter="red">   <span class="color-dot cd-red"></span>Ìú¥Í∞ÄÍ¥ÄÎ†®</button>
    <button class="filter-btn f-green"  data-filter="green"> <span class="color-dot cd-green"></span>Ï¥¨ÏòÅÍ¥ÄÎ†®</button>
    <button class="filter-btn f-purple" data-filter="purple"><span class="color-dot cd-purple"></span>ÎØ∏ÌåÖ/ÎÇ¥Î∞©</button>
  </div>
  <div class="date-range-wrap">
    <span class="date-range-label">Í∏∞Í∞Ñ</span>
    <label class="date-range-input-wrap">
      <input class="date-range-input" type="date" id="dateFrom" />
    </label>
    <span class="date-range-sep">‚Äî</span>
    <label class="date-range-input-wrap">
      <input class="date-range-input" type="date" id="dateTo" />
    </label>
    <button class="date-range-clear" id="dateRangeClear" style="display:none;">‚úï Ï¥àÍ∏∞Ìôî</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê SORT BAR ‚ïê‚ïê‚ïê -->
<div class="sort-bar">
  <div class="sort-col active" data-sort="title">Ï†úÎ™© <span class="sort-arrow" id="sa-title">‚Üë</span></div>
  <div class="sort-col hide-m" data-sort="startDate">ÎÇ†Ïßú <span class="sort-arrow" id="sa-startDate"></span></div>
  <div class="sort-col hide-m" data-sort="name">Îã¥ÎãπÏûê <span class="sort-arrow" id="sa-name"></span></div>
  <div class="sort-col" data-sort="color">Î∂ÑÎ•ò <span class="sort-arrow" id="sa-color"></span></div>
  <div>ÏòµÏÖò</div>
</div>

<!-- ‚ïê‚ïê‚ïê EVENT LIST ‚ïê‚ïê‚ïê -->
<div class="events-container" id="eventList"></div>

<!-- ‚ïê‚ïê‚ïê PAGINATION ‚ïê‚ïê‚ïê -->
<div class="pagination" id="pagination">
  <button class="page-btn" id="pagePrev" disabled>‚Äπ</button>
  <div id="pageNums" style="display:flex;gap:6px;"></div>
  <button class="page-btn" id="pageNext" disabled>‚Ä∫</button>
  <span class="page-info" id="pageInfo"></span>
</div>

<!-- ‚ïê‚ïê‚ïê DETAIL MODAL ‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="detailOverlay">
  <div class="modal">
    <div class="modal-strip" id="detailStrip"></div>
    <div class="modal-header">
      <div class="modal-header-info">
        <div class="modal-badge" id="detailBadge"></div>
        <div class="modal-event-title" id="detailTitle"></div>
      </div>
      <button class="modal-close" id="detailClose">‚úï</button>
    </div>
    <div class="modal-body" id="detailBody"></div>
    <div class="modal-footer">
      <button class="btn-modal-close" id="detailCloseBtn">Îã´Í∏∞</button>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê -->
<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê‚ïê LOADING ‚ïê‚ïê‚ïê -->
<div id="loadingOverlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:999;align-items:center;justify-content:center;flex-direction:column;gap:14px;backdrop-filter:blur(4px);">
  <div style="width:32px;height:32px;border:3px solid rgba(212,188,150,0.25);border-top-color:#d4bc96;border-radius:50%;animation:spin 0.8s linear infinite;"></div>
  <div style="font-family:var(--font-mono);font-size:11px;letter-spacing:0.15em;color:#d4bc96;opacity:0.8;">LOADING</div>
</div>
<style>@keyframes spin{to{transform:rotate(360deg)}}</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, onSnapshot }
  from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ */
const firebaseConfig = {
  apiKey: "AIzaSyDnEOATYmwq0WJr6pCl-86-Q3ZEQjrrfeY",
  authDomain: "drgo-calender.firebaseapp.com",
  projectId: "drgo-calender",
  storageBucket: "drgo-calender.firebasestorage.app",
  messagingSenderId: "163730741115",
  appId: "1:163730741115:web:73a06d5b1cf1a477734fde"
};

/* ‚îÄ‚îÄ AUTH (admin.htmlÍ≥º ÎèôÏùºÌïú ÎπÑÎ∞ÄÎ≤àÌò∏ Ìï¥Ïãú) ‚îÄ‚îÄ */
const AUTH_HASH  = 'b536e460b48ff9981aeee9b2cfb0bb01548a3b111fe16cdec6dbc5a4c6e7a4c2';
const SESSION_KEY = 'cal_view_ok';
const TRIES_KEY   = 'cal_view_tries';
const LOCK_KEY    = 'cal_view_lock';
const MAX_TRIES   = 5;
const LOCK_MS     = 120000;

async function sha256(str) {
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}
function isAuth()     { return sessionStorage.getItem(SESSION_KEY) === '1'; }
function getLockRem() { return Math.max(0, parseInt(localStorage.getItem(LOCK_KEY)||'0') - Date.now()); }

function updateLockUI() {
  const rem   = getLockRem();
  const tries = parseInt(localStorage.getItem(TRIES_KEY)||'0');
  const btn   = document.getElementById('authBtn');
  const lockEl= document.getElementById('authLock');
  if (rem > 0) {
    btn.disabled = true;
    lockEl.textContent = `${Math.ceil(rem/1000)}Ï¥à ÌõÑ Ïû¨ÏãúÎèÑ Í∞ÄÎä•`;
    setTimeout(updateLockUI, 1000);
  } else {
    btn.disabled = false;
    lockEl.textContent = tries > 0 ? `ÎÇ®ÏùÄ ÏãúÎèÑ: ${MAX_TRIES - tries}Ìöå` : '';
  }
}

async function tryAuth() {
  if (getLockRem() > 0) return;
  const inp   = document.getElementById('authInput');
  const errEl = document.getElementById('authError');
  if (!inp.value) return;
  const hash = await sha256(inp.value);
  if (hash === AUTH_HASH) {
    sessionStorage.setItem(SESSION_KEY, '1');
    localStorage.removeItem(TRIES_KEY);
    localStorage.removeItem(LOCK_KEY);
    document.getElementById('authOverlay').classList.add('hidden');
    initApp();
  } else {
    const tries = parseInt(localStorage.getItem(TRIES_KEY)||'0') + 1;
    localStorage.setItem(TRIES_KEY, tries);
    inp.value = '';
    inp.classList.add('error');
    setTimeout(() => inp.classList.remove('error'), 400);
    if (tries >= MAX_TRIES) {
      localStorage.setItem(LOCK_KEY, Date.now() + LOCK_MS);
      errEl.textContent = 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.';
      updateLockUI();
    } else {
      errEl.textContent = `ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§. (${MAX_TRIES - tries}Ìöå ÎÇ®Ïùå)`;
    }
    inp.focus();
  }
}

document.getElementById('authBtn').addEventListener('click', tryAuth);
document.getElementById('authInput').addEventListener('keydown', e => { if (e.key==='Enter') tryAuth(); });

if (isAuth()) {
  document.getElementById('authOverlay').classList.add('hidden');
  initApp();
} else {
  updateLockUI();
  setTimeout(() => document.getElementById('authInput').focus(), 100);
}

/* ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ */
const TYPE_LABELS    = { gold:'Í∞úÏù∏ÏùòÎ¢∞', blue:'ÏÇ¨ÎÇ¥ÏóÖÎ¨¥', red:'Ìú¥Í∞ÄÍ¥ÄÎ†®', green:'Ï¥¨ÏòÅÍ¥ÄÎ†®', purple:'ÎØ∏ÌåÖ/ÎÇ¥Î∞©' };
const SPECIAL_LABELS = { car:'üöóÏ∞®Îüâ', brief:'üíºÏ†úÌíà', 'return':'‚ÜêÎãπÍπÄ', group:'üë•2Ïù∏', urgent:'üö®Í∏¥Í∏â', ladder:'ü™úÏÇ¨Îã§Î¶¨' };
const SCHED_LABELS   = { suggest:'üí¨Ï†úÏïà', hope:'üôèÌù¨Îßù', target:'üéØÎ™©Ìëú' };

/* ‚îÄ‚îÄ STATE ‚îÄ‚îÄ */
let allEvents      = [];
let filteredEvents = [];
let currentFilter  = 'all';
let searchQuery    = '';
let sortKey        = 'startDate';
let sortDir        = 1;
let currentPage    = 1;
const PAGE_SIZE    = 30;
let dateFrom = '', dateTo = '';

/* ‚îÄ‚îÄ APP INIT ‚îÄ‚îÄ */
function initApp() {
  /* Theme */
  const saved = localStorage.getItem('cal_theme');
  if (saved === 'light') document.documentElement.classList.add('light');
  const themeBtn = document.getElementById('themeBtn');
  themeBtn.textContent = document.documentElement.classList.contains('light') ? '‚òÄÔ∏è' : 'üåô';
  themeBtn.addEventListener('click', () => {
    const isL = document.documentElement.classList.toggle('light');
    localStorage.setItem('cal_theme', isL ? 'light' : 'dark');
    themeBtn.textContent = isL ? '‚òÄÔ∏è' : 'üåô';
  });

  /* Firebase */
  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);
  const col = collection(db, 'events');

  const loadingEl = document.getElementById('loadingOverlay');
  loadingEl.style.display = 'flex';
  const loadTimeout = setTimeout(() => { loadingEl.style.display = 'none'; }, 10000);

  onSnapshot(col, snap => {
    clearTimeout(loadTimeout);
    loadingEl.style.display = 'none';
    allEvents = snap.docs.map(d => ({ _id: d.id, ...d.data() }));
    applyFilters();
    updateStats();
  }, err => {
    clearTimeout(loadTimeout);
    loadingEl.style.display = 'none';
    showToast('Ïó∞Í≤∞ Ïã§Ìå®: ' + err.message, 'error');
  });

  /* Í≤ÄÏÉâ */
  document.getElementById('searchInput').addEventListener('input', e => {
    searchQuery = e.target.value.toLowerCase();
    currentPage = 1; applyFilters();
  });

  /* ÎÇ†Ïßú Î≤îÏúÑ */
  document.getElementById('dateFrom').addEventListener('change', e => {
    dateFrom = e.target.value; syncDateClear(); currentPage = 1; applyFilters();
  });
  document.getElementById('dateTo').addEventListener('change', e => {
    dateTo = e.target.value; syncDateClear(); currentPage = 1; applyFilters();
  });
  document.getElementById('dateRangeClear').addEventListener('click', () => {
    dateFrom = ''; dateTo = '';
    document.getElementById('dateFrom').value = '';
    document.getElementById('dateTo').value   = '';
    syncDateClear(); currentPage = 1; applyFilters();
  });

  /* ÌïÑÌÑ∞ */
  document.getElementById('filterGroup').addEventListener('click', e => {
    const btn = e.target.closest('.filter-btn');
    if (!btn) return;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentFilter = btn.dataset.filter;
    currentPage = 1; applyFilters();
  });

  /* Ï†ïÎ†¨ */
  document.querySelectorAll('.sort-col').forEach(colEl => {
    colEl.addEventListener('click', () => {
      const key = colEl.dataset.sort;
      if (sortKey === key) sortDir *= -1;
      else { sortKey = key; sortDir = 1; }
      document.querySelectorAll('.sort-col').forEach(c => c.classList.remove('active'));
      colEl.classList.add('active');
      document.querySelectorAll('.sort-arrow').forEach(a => a.textContent = '');
      const arrow = document.getElementById('sa-' + key);
      if (arrow) arrow.textContent = sortDir === 1 ? '‚Üë' : '‚Üì';
      applyFilters();
    });
  });

  /* ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò */
  document.getElementById('pagePrev').addEventListener('click', () => {
    if (currentPage > 1) { currentPage--; renderList(); }
  });
  document.getElementById('pageNext').addEventListener('click', () => {
    const total = Math.ceil(filteredEvents.length / PAGE_SIZE);
    if (currentPage < total) { currentPage++; renderList(); }
  });

  /* Î™®Îã¨ Îã´Í∏∞ */
  document.getElementById('detailClose').addEventListener('click',    () => document.getElementById('detailOverlay').classList.remove('open'));
  document.getElementById('detailCloseBtn').addEventListener('click', () => document.getElementById('detailOverlay').classList.remove('open'));
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') document.getElementById('detailOverlay').classList.remove('open');
  });
}

function syncDateClear() {
  document.getElementById('dateRangeClear').style.display = (dateFrom || dateTo) ? '' : 'none';
}

/* ‚îÄ‚îÄ FILTER / SORT ‚îÄ‚îÄ */
function applyFilters() {
  let evs = [...allEvents];
  if (currentFilter !== 'all') evs = evs.filter(e => (e.color||'gold') === currentFilter);
  if (searchQuery) evs = evs.filter(e =>
    (e.title||'').toLowerCase().includes(searchQuery) ||
    (e.name||'').toLowerCase().includes(searchQuery)  ||
    (e.address||'').toLowerCase().includes(searchQuery) ||
    (e.gold?.name||'').toLowerCase().includes(searchQuery)
  );
  if (dateFrom) evs = evs.filter(e => e.startDate >= dateFrom);
  if (dateTo)   evs = evs.filter(e => e.startDate <= dateTo);
  evs.sort((a, b) => {
    let av = a[sortKey]||'', bv = b[sortKey]||'';
    if (sortKey === 'color') { av = TYPE_LABELS[av]||''; bv = TYPE_LABELS[bv]||''; }
    return av < bv ? -sortDir : av > bv ? sortDir : 0;
  });
  filteredEvents = evs;
  currentPage = Math.min(currentPage, Math.max(1, Math.ceil(evs.length / PAGE_SIZE)));
  renderList();
}

function updateStats() {
  document.getElementById('st-total').textContent  = allEvents.length;
  document.getElementById('st-gold').textContent   = allEvents.filter(e=>(e.color||'gold')==='gold').length;
  document.getElementById('st-blue').textContent   = allEvents.filter(e=>e.color==='blue').length;
  document.getElementById('st-red').textContent    = allEvents.filter(e=>e.color==='red').length;
  document.getElementById('st-green').textContent  = allEvents.filter(e=>e.color==='green').length;
  document.getElementById('st-purple').textContent = allEvents.filter(e=>e.color==='purple').length;
}

/* ‚îÄ‚îÄ RENDER LIST ‚îÄ‚îÄ */
function renderList() {
  const list       = document.getElementById('eventList');
  const total      = filteredEvents.length;
  const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
  const start      = (currentPage - 1) * PAGE_SIZE;
  const pageEvs    = filteredEvents.slice(start, start + PAGE_SIZE);

  list.innerHTML = '';
  if (pageEvs.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-text">ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§</div></div>`;
    return;
  }

  pageEvs.forEach(ev => {
    const c       = ev.color || 'gold';
    const row     = document.createElement('div');
    row.className = 'event-row';

    const dateStr    = ev.startDate || '';
    const endStr     = ev.endDate && ev.endDate !== ev.startDate ? ` ~ ${ev.endDate}` : '';
    const flags      = [
      ...(ev.specialOpts||[]).map(k => SPECIAL_LABELS[k]||''),
      ...(ev.schedOpt ? [SCHED_LABELS[ev.schedOpt]||''] : []),
      ...(ev.locked   ? ['üîí'] : [])
    ];
    const personName = c === 'gold' ? (ev.gold?.name || ev.name || '') : (ev.name || '');
    const personAddr = ev.address || '';
    const personCell = personName
      ? `${personName}${personAddr ? `<br><span style="font-size:11px;color:var(--text-muted);opacity:0.85">üìç ${personAddr}</span>` : ''}`
      : (personAddr ? `<span style="font-size:11px;color:var(--text-muted)">üìç ${personAddr}</span>` : '‚Äî');

    row.innerHTML = `
      <div class="row-title">
        <div class="color-bar cb-${c}"></div>
        <div>
          <div class="title-text">${ev.title||'(Ï†úÎ™© ÏóÜÏùå)'}</div>
          ${ev.desc ? `<div class="title-sub">${ev.desc.slice(0,40)}${ev.desc.length>40?'‚Ä¶':''}</div>` : ''}
        </div>
      </div>
      <div class="row-date hide-m">${dateStr}${endStr}</div>
      <div class="row-person hide-m">${personCell}</div>
      <div><span class="row-badge rb-${c}">${TYPE_LABELS[c]||c}</span></div>
      <div class="row-flags">${flags.map(f=>`<span title="${f}">${f.slice(0,2)}</span>`).join('')}</div>`;

    row.addEventListener('click', () => openDetail(ev));
    list.appendChild(row);
  });

  /* ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò */
  document.getElementById('pagePrev').disabled = currentPage <= 1;
  document.getElementById('pageNext').disabled = currentPage >= totalPages;
  const nums = document.getElementById('pageNums');
  nums.innerHTML = '';
  const range = 3;
  for (let p = Math.max(1, currentPage-range); p <= Math.min(totalPages, currentPage+range); p++) {
    const btn = document.createElement('button');
    btn.className = 'page-btn' + (p === currentPage ? ' active' : '');
    btn.textContent = p;
    btn.addEventListener('click', () => { currentPage = p; renderList(); });
    nums.appendChild(btn);
  }
  document.getElementById('pageInfo').textContent =
    `${start+1}‚Äì${Math.min(start+PAGE_SIZE, total)} / ${total}Í±¥`;
}

/* ‚îÄ‚îÄ DETAIL MODAL ‚îÄ‚îÄ */
function openDetail(ev) {
  const c = ev.color || 'gold';
  document.getElementById('detailStrip').className   = 'modal-strip ms-' + c;
  document.getElementById('detailBadge').textContent = `${ev.startDate||''} ¬∑ ${TYPE_LABELS[c]||c}`;
  document.getElementById('detailTitle').textContent = ev.title || '(Ï†úÎ™© ÏóÜÏùå)';

  const body = document.getElementById('detailBody');
  body.innerHTML = '';

  /* Í∏∞Î≥∏ Ï†ïÎ≥¥ */
  body.appendChild(makeSection('Í∏∞Î≥∏ Ï†ïÎ≥¥', [
    ['ÏãúÏûëÏùº',     ev.startDate||'‚Äî'],
    ['Ï¢ÖÎ£åÏùº',     ev.endDate||ev.startDate||'‚Äî'],
    ['ÏãúÍ∞Ñ',       ev.allDay!==false ? 'Ï¢ÖÏùº' : `${ev.startTime||'?'} ~ ${ev.endTime||'?'}`],
    ['Î∂ÑÎ•ò',       TYPE_LABELS[c]||c],
    ['Îã¥ÎãπÏûê',     ev.name||(ev.gold?.name)||'‚Äî'],
    ['Ï£ºÏÜå',       ev.address||'‚Äî'],
    ['Ïû†Í∏à',       ev.locked ? 'üîí Ïû†Í∏àÎê®' : 'ÏóÜÏùå'],
    ['ÌäπÏàòÏòµÏÖò',   (ev.specialOpts||[]).map(k=>SPECIAL_LABELS[k]||k).join(', ') || (ev.schedOpt ? SCHED_LABELS[ev.schedOpt] : 'ÏóÜÏùå')],
  ]));

  if (ev.desc) body.appendChild(makeSection('ÏÉÅÏÑ∏ ÏÑ§Î™Ö', [['ÎÇ¥Ïö©', ev.desc]]));

  /* Í∞úÏù∏ÏùòÎ¢∞(gold) Ï†ÑÏö© */
  if (c === 'gold' && ev.gold) {
    const g = ev.gold;
    body.appendChild(makeSection('ÏùòÎ¢∞Ïûê Ï†ïÎ≥¥', [
      ['ÏùòÎ¢∞Ïûê',   g.name||'‚Äî'],
      ['Ï†ÑÌôîÎ≤àÌò∏', g.phone||'‚Äî'],
      ['ÌîåÎû´Ìèº',   g.platform||'‚Äî'],
      ['Î∞©ÏÜ°Ï£ºÏ†ú', g.topic||'‚Äî'],
      ['Í≤ΩÎ†•',     g.career||'‚Äî'],
      ['Í≤∞Ï†ú',     g.paid||'‚Äî'],
      ['Ï£ºÎ¨∏Ï†úÌíà', g.order||'‚Äî'],
      ['ÏûîÍ∏à',     g.balance||'‚Äî'],
      ['ÏûîÍ∏àÍ∏àÏï°', g.balance_amount||'‚Äî'],
    ]));
    if (g.equipment)              body.appendChild(makeSection('Ïû•ÎπÑ Î™©Î°ù',  [['Ïû•ÎπÑ', g.equipment]]));
    if (g.req_topic||g.req_detail) body.appendChild(makeSection('ÏùòÎ¢∞ ÎÇ¥Ïö©', [['Ï£ºÏ†ú',g.req_topic||'‚Äî'],['ÏÑ∏Î∂Ä',g.req_detail||'‚Äî']]));
    if (g.special)                 body.appendChild(makeSection('ÌäπÏù¥ÏÇ¨Ìï≠',  [['ÎÇ¥Ïö©', g.special]]));
    const imgCount = (g.quoteImgs||[]).length + (g.refImgs||[]).length + (g.roomImgs||[]).length;
    if (imgCount > 0) body.appendChild(makeSection('Ï≤®Î∂Ä Ïù¥ÎØ∏ÏßÄ', [['Ïù¥ÎØ∏ÏßÄ Ïàò', `${imgCount}Í∞ú`]]));
  }

  /* ÎØ∏ÌåÖ/ÎÇ¥Î∞©(purple) Ï†ÑÏö© */
  if (c === 'purple') {
    const meetFields = [];
    if (ev.name)    meetFields.push(['Îã¥ÎãπÏûê/Ï∞∏ÏÑùÏûê', ev.name]);
    if (ev.address) meetFields.push(['Ïû•ÏÜå', ev.address]);
    if (ev.desc)    meetFields.push(['ÎÇ¥Ïö©', ev.desc]);
    if (meetFields.length > 0) body.appendChild(makeSection('ÎØ∏ÌåÖ/ÎÇ¥Î∞© Ï†ïÎ≥¥', meetFields));
  }

  if ((ev.attachments||[]).length > 0)
    body.appendChild(makeSection('Ï≤®Î∂Ä ÌååÏùº', [['ÌååÏùº Ïàò', `${ev.attachments.length}Í∞ú`]]));

  document.getElementById('detailOverlay').classList.add('open');
}

function makeSection(title, fields) {
  const sec  = document.createElement('div'); sec.className = 'detail-section';
  const t    = document.createElement('div'); t.className = 'detail-section-title'; t.textContent = title;
  const grid = document.createElement('div'); grid.className = 'detail-grid';
  fields.forEach(([k, v]) => {
    const item = document.createElement('div'); item.className = 'detail-item';
    const key  = document.createElement('div'); key.className = 'detail-key'; key.textContent = k;
    const val  = document.createElement('div');
    val.className = 'detail-val' + (!v || v === '‚Äî' ? ' empty' : '');
    val.textContent = v || '‚Äî';
    item.appendChild(key); item.appendChild(val); grid.appendChild(item);
  });
  sec.appendChild(t); sec.appendChild(grid);
  return sec;
}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
let toastTimer;
function showToast(msg, type='info') {
  const t = document.getElementById('toast');
  t.textContent = type==='success' ? '‚úì '+msg : type==='error' ? '‚úï '+msg : '‚Ñπ '+msg;
  t.className   = 'toast show ' + type;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 4000);
}
</script>
</body>
</html>
